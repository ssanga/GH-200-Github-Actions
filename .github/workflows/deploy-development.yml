name: ğŸš€ Deploy to Development

on:
  push:
    branches: [ development ]
  workflow_dispatch:  # Permite ejecuciÃ³n manual

jobs:
  deploy-dev:
    name: ğŸ› ï¸ Despliegue a Development
    runs-on: ubuntu-latest
    environment: 
      name: development
      url: https://dev.calculadora-app.com  # URL simulada
    
    steps:
    - name: Checkout cÃ³digo
      uses: actions/checkout@v4
    
    - name: ğŸ“‹ InformaciÃ³n del Despliegue
      run: |
        echo "ğŸš€ === DESPLIEGUE A DEVELOPMENT ==="
        echo "ğŸ‘¤ Desplegado por: ${{ github.actor }}"
        echo "ğŸ†” Commit: ${{ github.sha }}" | cut -c1-8
        echo "ğŸŒ¿ Rama: ${{ github.ref_name }}"
        echo "ğŸ“… Fecha: $(date -Iseconds)"
        echo "ğŸ¯ Entorno: Development"
        echo "ğŸ”— URL: https://dev.calculadora-app.com"
    
    - name: Configurar Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'
    
    - name: Instalar dependencias
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
    
    - name: ğŸ§ª Tests rÃ¡pidos pre-despliegue
      run: |
        echo "Ejecutando tests crÃ­ticos antes del despliegue..."
        python -m unittest test_calculadora.TestCalculadora.test_sumar -v
        python -m unittest test_calculadora.TestCalculadora.test_dividir_por_cero -v
    
    - name: ğŸ“¦ Simular Build de la AplicaciÃ³n
      run: |
        echo "ğŸ”¨ Construyendo aplicaciÃ³n para Development..."
        mkdir -p dist
        cp calculadora.py dist/
        echo "VERSION=$(git rev-parse --short HEAD)" > dist/.env
        echo "ENVIRONMENT=development" >> dist/.env
        echo "BUILD_DATE=$(date -Iseconds)" >> dist/.env
        echo "âœ… Build completado"
    
    - name: ğŸš€ Simular Despliegue
      run: |
        echo "ğŸš€ Desplegando a Development..."
        echo "ğŸ“ Contenido a desplegar:"
        ls -la dist/
        echo ""
        echo "ğŸ”§ ConfiguraciÃ³n del entorno:"
        cat dist/.env
        echo ""
        echo "ğŸŒ Simulando despliegue a servidor de desarrollo..."
        sleep 2
        echo "âœ… AplicaciÃ³n desplegada exitosamente en Development"
        echo "ğŸ”— Disponible en: https://dev.calculadora-app.com"
    
    - name: ğŸ§ª Tests de Humo Post-Despliegue
      run: |
        echo "ğŸ§ª Ejecutando tests de humo..."
        python calculadora.py
        echo "âœ… Tests de humo pasaron correctamente"
    
    - name: ğŸ“Š NotificaciÃ³n de Despliegue
      run: |
        echo "ğŸ“¢ === NOTIFICACIÃ“N DE DESPLIEGUE ==="
        echo "âœ… Despliegue a Development completado exitosamente"
        echo "ğŸ‘¤ Por: ${{ github.actor }}"
        echo "ğŸ†” Commit: ${{ github.sha }}"
        echo "â° En: $(date)"
        echo "ğŸ”— URL: https://dev.calculadora-app.com"
        echo ""
        echo "ğŸ“‹ PrÃ³ximos pasos:"
        echo "- Verificar funcionalidad en Development"
        echo "- Crear PR hacia main para Staging"
        echo "- Ejecutar tests de integraciÃ³n"